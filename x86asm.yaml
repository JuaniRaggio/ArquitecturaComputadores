# VM Configuration file
arch: "x86_64"
cpus: 2
memory: "2GiB"
disk: "12GiB"

images:
  - location: "https://cloud-images.ubuntu.com/jammy/current/jammy-server-cloudimg-amd64.img"
    arch: "x86_64"

mounts:
  - location: "/Users/juaniraggio/workspace/itbaworkspace/arquitectura"
    writable: true

provision:
  - mode: system
    script: |
      set -eux
      apt-get update
      DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \
        xauth x11-apps x11-utils dbus-x11 mesa-utils \
        build-essential nasm gdb strace file openssh-server

      sed -i 's/^#\?X11Forwarding.*/X11Forwarding yes/' /etc/ssh/sshd_config
      sed -i 's/^#\?X11UseLocalhost.*/X11UseLocalhost yes/' /etc/ssh/sshd_config
      systemctl restart ssh

      cat >/etc/profile.d/x11-indirect.sh <<'EOF'
      if [[ "${DISPLAY:-}" == localhost:* ]]; then
        export LIBGL_ALWAYS_INDIRECT=1
      fi
      EOF
